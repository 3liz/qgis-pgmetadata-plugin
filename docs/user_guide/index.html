
<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>PgMetadata</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css" rel="stylesheet"/>
  <link href="https://docs.3liz.org/remarkable.css" rel="stylesheet"/>
  <link href="../icon.png" rel="icon" type="image/png" >
 </head>
 <body>
 <header class="header-container" style="">
    <h1>PgMetadata</h1>
 </header>
 <article>
<p><a href="./../">Up</a></p>

<div class="toc"><span class="toctitle">Table of content</span><ul>
<li><a href="#for-the-normal-user">For the normal user</a><ul>
<li><a href="#deploying-within-an-organization">Deploying within an organization</a></li>
<li><a href="#locator">Locator</a></li>
<li><a href="#datasource-manager">Datasource manager</a></li>
<li><a href="#panel">Panel</a></li>
<li><a href="#export">Export</a></li>
</ul>
</li>
<li><a href="#for-the-administrator">For the administrator</a><ul>
<li><a href="#installation">Installation</a><ul>
<li><a href="#database">Database</a></li>
<li><a href="#administration-project">Administration project</a></li>
<li><a href="#editing-metadata">Editing metadata</a></li>
</ul>
</li>
<li><a href="#html-template">HTML Template</a></li>
</ul>
</li>
<li><a href="#lizmap-web-client">Lizmap Web Client</a></li>
</ul>
</div>
<h1 id="for-the-normal-user">For the normal user</h1>
<h2 id="deploying-within-an-organization">Deploying within an organization</h2>
<p>The system administrator can hide PgMetadata Processing algorithms from normal users by adding an environment
variable <code>QGIS_PGMETADATA_END_USER_ONLY</code>. If this variable exists, Processing algorithms won't be displayed.
It's possible to use the <code>QGIS3.ini</code> file instead with <code>end_user_only</code>.</p>
<p>In the <code>QGIS3.ini</code> file within an organisation, you may want some hardcoded configuration :</p>
<pre><code class="ini">[pgmetadata]
auto_open_dock=true
end_user_only=true
connection_names=Connection 1;Connection 2;Connection 3

[Plugins]
pg_metadata=true
</code></pre>

<h2 id="locator">Locator</h2>
<p>Type <code>ctrl+k</code> in QGIS to open the locator widget. You can start type <code>meta</code> then you should see layers in the
list.</p>
<h2 id="datasource-manager">Datasource manager</h2>
<p>This works without the plugin installed on the computer. It's native in QGIS.</p>
<p><img alt="Search with comment" src="../img/datasource_manager.png"></p>
<h2 id="panel">Panel</h2>
<p>The PgMetadata panel can be opened. If set, the layer metadata will be displayed according to the layer 
selected in the legend.</p>
<h2 id="export">Export</h2>
<p>To export metadata as PDF, HTML or DCAT, you need to select a layer in your layer tree saved in the metadata 
table <code>dataset</code>. Then in the dock you have a button to open the <code>export menu</code> and choose the output format.</p>
<p><img alt="Button Export" src="../img/dockpgmetadata_with_metadata.png"></p>
<p>If no layer with metadata are selected, you can't click on the button of the <code>export menu</code>.</p>
<p><img alt="Button Export without metadata" src="../img/dockpgmetadatawithoutmetadata.png"></p>
<h1 id="for-the-administrator">For the administrator</h1>
<h2 id="installation">Installation</h2>
<h3 id="database">Database</h3>
<ol>
<li>The plugin is using a schema in PostgreSQL.<ul>
<li>If you just installed the plugin in a new organization, you must
use the <a href="../processing/index.html#installation-of-the-database-structure">install database structure</a></li>
<li>If the <code>pgmetadata</code> schema is already existing in your database, you may need to upgrade it after a 
plugin upgrade using the 
<a href="../processing/index.html#upgrade-the-database-structure">upgrade database structure</a></li>
</ul>
</li>
</ol>
<h3 id="administration-project">Administration project</h3>
<ol>
<li>The GIS administrator can generate a QGIS project using 
<a href="../processing/index.html#create-metadata-administration-project">create metadata project</a>. You need to open
the generated project and use the normal QGIS editing tools.</li>
<li>In the group called <code>Information Warnings</code> :<ul>
<li><code>Orphan metadata</code> displays tables not existing in the database itself, but the metadata exists in the
<code>dataset</code> table.</li>
<li><code>Orphan tables</code> is the reverse. It displays tables existing in the database but in the <code>dataset</code> table.</li>
</ul>
</li>
</ol>
<h3 id="editing-metadata">Editing metadata</h3>
<p>Before creating metadata for your layer/table, you need to implement some table. To edit this table you need
to open the attribute table, switch on <strong>Edition</strong> mode and add a new row.</p>
<p>Switching to edit mode:</p>
<p><img alt="Attribute table" src="../img/attribute_table_edit_mode.png"></p>
<p>Adding a new row:</p>
<p><img alt="Attribute table" src="../img/attribute_table_new_row.png"></p>
<p>Switching to the form view: You can access the form view at the bottom right corner of the attribute table.</p>
<p><img alt="Attribute table" src="../img/attribute_table_view_form.png"></p>
<ol>
<li>
<p>On the <code>Theme</code> table you can add many theme corresponding to different theme of your layers.
    You need to enter a <strong>code</strong> e.g. "A01" and a <strong>label</strong> corresponding at the name e.g. "Naturals area".
    Example adding theme:</p>
<p><img alt="Attribute table" src="../img/attribute_table_add_theme.png"></p>
</li>
<li>
<p>On the <code>Contact</code> table you can add contacts that can later be associated with your metadata layer.
    Example new contact:</p>
<p><img alt="Attribute table" src="../img/attribute_table_add_contact.png"></p>
</li>
<li>
<p>The <code>Dataset</code> table is the metadata table. You can add many rows and one added line corresponds to a 
   metadata of a layer.
    You need to fill a row with these minimum information : </p>
<ul>
<li>Table name,</li>
<li>Schema name,</li>
<li>Title,</li>
<li>Abstract,</li>
<li>Etc</li>
</ul>
<p>Example to add a new metadata for a layer:
  On the second picture you can see the theme.</p>
<p><img alt="Attribute table" src="../img/attribute_table_add_dataset.png"></p>
</li>
<li>
<p>Now you can add a contact to a dataset row with the <code>Dataset</code> table. You can click on a tab called <code>contact</code>.
    You need to allow <strong>edit mode</strong> in this tab because you implement an other table.
    Example:</p>
<p><img alt="Attribute table" src="../img/attribute_table_add_contact.png"></p>
</li>
<li>
<p>And now you can add some<code>Link</code> to a dataset row with the <code>Dataset</code> table. It's same that to add a contact,
   you have a link tab.
    Don't forget to allow <strong>edit mode</strong>.
    Example:</p>
<p><img alt="Attribute table" src="../img/attribute_table_add_link.png"></p>
</li>
</ol>
<p>When you stop editing a table, don't forget to save your change with clicking on the save icon et leave the
edit mode.
To save:</p>
<p><img alt="Attribute table" src="../img/attribute_table_save.png"></p>
<p>To leave the edit mode you need to click on the same button that to enter the edit mode.</p>
<h2 id="html-template">HTML Template</h2>
<p>You can customize the HTML template.</p>
<ul>
<li>Use <code>[% "name_of_field" %]</code> to display a specific field, eg <code>abstract</code>.</li>
<li>use <code>[% meta_contacts %]</code> to display all contacts related. It's using the template called <code>contact</code>.</li>
<li>use <code>[% meta_links %]</code> to display all links related. It's using the template called <code>link</code>.</li>
</ul>
<h1 id="lizmap-web-client">Lizmap Web Client</h1>
<p>The metadata can be displayed in the QGIS Lizmap Web Client using the
<a href="https://github.com/3liz/lizmap-pgmetadata-module">module</a>. The module is also providing a DCAT catalog.</p>
<p><a href="./../">Up</a></p>

  </article>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js">
  </script>
  <script>
   hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
  </script>
  <script type="text/javascript">
   MathJax.Hub.Config({"showProcessingMessages" : false,"messageStyle" : "none","tex2jax": { inlineMath: [ [ "$", "$" ] ] }});
  </script>
 </body>
</html>
