{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"PgMetadata","text":""},{"location":"#short-introduction","title":"Short introduction","text":"<p>It's a QGIS plugin to store some metadata for PostgreSQL layers inside a PostgreSQL database \ud83d\udc18.</p> <p>Metadata for a PostgreSQL table includes :</p> <ul> <li>a title</li> <li>an abstract</li> <li>keywords  </li> <li>categories and themes  </li> <li>spatial properties such as extent, feature count, projection, scales</li> <li>0 or many contacts with a role  </li> <li>0 or many links</li> <li>\u2026</li> </ul> <p>Some key features for final users :</p> <ul> <li>a locator to easy search and add layers</li> <li>a dock to display metadata</li> <li>Export a single sheet to PDF, HTML DCAT</li> <li>Export the full catalog</li> </ul> <p>Some features for the GIS administrator :</p> <ul> <li>A QGIS project designed to manage the metadata.</li> <li>Some views are included to detect some orphaned tables.</li> <li>Customization of the HTML template</li> </ul> <p>To help, there are some videos tutorials.</p> <p></p>"},{"location":"#description","title":"Description","text":"<p>PgMetadata is made for people using QGIS as their main GIS application, and PostgreSQL \ud83d\udc18 as their main vector data storage.</p> <p>The metadata of layers are stored inside your PostgreSQL database, in a dedicated schema. Classical fields are supported, such as the <code>title</code>, <code>description</code>, <code>categories</code>, <code>themes</code>, <code>links</code>, and the spatial properties of your data: <code>extent</code>, <code>projection</code>, etc.</p> <p>PgMetadata is not designed as a catalog application which lets you search among datasets and then download the data. It is designed to ease the use of the metadata inside QGIS, allowing to search for a data and open the corresponding layer, or to view the metadata of the already loaded PostgreSQL layers.</p> <p>By storing the metadata of the vector tables inside the database:</p> <ul> <li>QGIS can read the metadata easily by using the layer PostgreSQL connection: a dock shows the metadata for the active layer when the plugin detects metadata exists for this QGIS layer.</li> <li>QGIS can run SQL queries: you can use the QGIS locator search bar to search for a layer, and load it easily in your project.</li> </ul> <p>The administrator in charge of editing the metadata will also benefit from the PostgreSQL storage:</p> <ul> <li>PostgreSQL/PostGIS functions are used to automatically update some fields based on the table data (the layer extent, geometry type, feature count, projection, etc.).</li> <li>The metadata is saved with your data anytime you backup the database.</li> <li>You do not need to share XML files across the network or install a new catalog application to manage your metadata and allow the users to get it. Only PostgreSQL is needed.</li> </ul> <p>The plugin contains some processing algorithms to help the administrator. For example:</p> <ul> <li>a script helps to create or update the needed <code>pgmetadata</code> PostgreSQL schema and tables in your database.</li> <li>a algorithm creates a QGIS project suitable for the metadata editing. This project uses the power of QGIS to create a rich user interface allowing to edit your metadata easily (forms, relations). Why use another interface when QGIS rocks ?</li> </ul> <p>More PgMetadata features:</p> <ul> <li>Modification of the HTML template to tune the displayed metadata</li> <li>Export a metadata sheet to PDF, HTML or DCAT</li> <li>Publish the metadata as a DCAT catalog with the Lizmap Web Client module for PgMetadata. It can then be harvested by external applications (Geonetwork, CKAN)</li> <li>The data model is very close to the QGIS metadata storage and the DCAT vocabulary for compatibility.</li> </ul>"},{"location":"CHANGELOG/","title":"Changelog","text":""},{"location":"CHANGELOG/#unreleased","title":"Unreleased","text":""},{"location":"CHANGELOG/#131-2024-09-02","title":"1.3.1 - 2024-09-02","text":"<ul> <li>Fix Python error if no previous folder was found </li> <li>Raise to QGIS 3.22 minimum version</li> <li>Upgrade to PostgreSQL 13 for testing and SQL files</li> </ul>"},{"location":"CHANGELOG/#130-2024-02-05","title":"1.3.0 - 2024-02-05","text":"<ul> <li>Additional glossary terms for publication frequency and link types (contribution from @effjot Florian Jenn)</li> <li>Glossary terms for unknown license and confidentiality</li> <li>Add remaining INSPIRE contact roles and UK Open Government Licence</li> <li>Add \u201cnon-standard\u201d contact roles and publication frequencies</li> <li>Add remaining INSPIRE contact roles and UK Open Government Licence (contribution from @mixedbredie Ross McDonald)</li> <li>Fix icon for layers having M values (linear referencing) (contribution from @effjot Florian Jenn)</li> <li>Review German translations (contribution from @effjot Florian Jenn)</li> </ul>"},{"location":"CHANGELOG/#122-2023-05-15","title":"1.2.2 - 2023-05-15","text":"<ul> <li>Fix \"array exceeds maximum\" for layers with many features (contribution from @effjot Florian Jenn)</li> </ul>"},{"location":"CHANGELOG/#121-2022-09-07","title":"1.2.1 - 2022-09-07","text":"<ul> <li>Fix a warning about invalid database</li> <li>Add the phone field to \"Contacts\" in the administration project</li> </ul>"},{"location":"CHANGELOG/#120-2022-09-05","title":"1.2.0 - 2022-09-05","text":"<ul> <li>License - Release PgMetadata under the GNU General Public License v2.0.</li> <li>Raise the QGIS minimum version to 3.16</li> <li>Add raster support (contribution from @effjot Florian Jenn)</li> <li>Fix handling of backslashes in file:// links to Windows files (contribution from @effjot Florian Jenn)</li> <li>Add phone number field (contribution from @effjot Florian Jenn)</li> <li>Email links are now clickable</li> <li>Connection names are now separated by <code>!!::!!</code> so that semicolons (former separator) can be used in connection names</li> </ul>"},{"location":"CHANGELOG/#111-2022-02-14","title":"1.1.1 - 2022-02-14","text":"<ul> <li>Fix an error when PgMetadata database is not temporary reachable</li> <li>Check that PostgreSQL is minimum 9.6 when installing the schema</li> </ul>"},{"location":"CHANGELOG/#110-2021-09-29","title":"1.1.0 - 2021-09-29","text":"<ul> <li>Add support for PostgreSQL views (contribution from @tschuettenberg QGIS Germany)</li> <li>Add translations for the German language (contribution from @effjot)</li> <li>Add new contact role \"originator\" and \"processor\" (contribution from @effjot)</li> <li>Add new frequencies for data update \"biannually\", \"irregular\" and \"not planned\" (contribution from @effjot)</li> <li>Add new German licenses (contribution from @effjot)</li> <li>Add more fields when searching with the locator bar (contribution from @effjot)</li> <li>Fix encoding issues in some situations, always set UTF-8 when opening files</li> <li>Fix the administration project about constraint with date but without a default value</li> <li>Update also the field \"update_date\" when updating a dataset entry in the trigger</li> </ul>"},{"location":"CHANGELOG/#100-2021-05-27","title":"1.0.0 - 2021-05-27","text":"<ul> <li>Add links to the file browser after exporting to PDF, HTML or XML</li> <li>Fix an issue when loading a layer from the locator bar, the style wasn't loaded before</li> <li>Update documentation https://docs.3liz.org/qgis-pgmetadata-plugin/</li> <li>Release on https://plugins.qgis.org</li> </ul>"},{"location":"CHANGELOG/#050-2021-02-19","title":"0.5.0 - 2021-02-19","text":"<ul> <li>Review the full online documentation using a proper website</li> <li>Add a link to the plugin online help in the QGIS help menu</li> <li>Add a button to open the dock from the QGIS plugin menu</li> <li>Add a layer flattening the \"dataset\" table containing all links and contacts, easier to export all the catalog</li> <li>Improve the deployment of the plugin within an organization to hide and setup some tools in PgMetadata</li> </ul>"},{"location":"CHANGELOG/#040-2021-01-21","title":"0.4.0 - 2021-01-21","text":"<ul> <li>Improve documentation user guide and schemaspy</li> <li>Save a metadata sheet as DCAT XML</li> <li>Add localized glossary labels and description : it, fr, es, de</li> <li>Display the translated HTML in the dock when available</li> <li>Add data_last_update in the HTML template</li> <li>Add some layers in the QGIS administration project</li> </ul>"},{"location":"CHANGELOG/#030-2020-12-14","title":"0.3.0 - 2020-12-14","text":"<ul> <li>Update online documentation</li> <li>Add export as PDF/HTML button in the dock</li> </ul>"},{"location":"CHANGELOG/#022-2020-11-17","title":"0.2.2 - 2020-11-17","text":"<ul> <li>Fix locator SQL query</li> <li>Add themes</li> <li>Update of the QGIS project</li> </ul>"},{"location":"CHANGELOG/#021-2020-11-16","title":"0.2.1 - 2020-11-16","text":"<ul> <li>Improve HTML templates for making them compatible with Lizmap</li> <li>SQL - Fix calculate a spatial field with Z or M geometries</li> <li>SQL - Fix HTML generation for fields email and size</li> <li>Processing - Fix upgrade algorithm and add tests</li> <li>Fix bug with empty links when link has no mime or type - fixes #34</li> <li>SQL - Fix if the envelope is a point, or a line</li> <li>SQL - Add a view to query only valid dataset with the locator</li> <li>Fix running migrations in the Processing algorithm</li> </ul>"},{"location":"CHANGELOG/#020-2020-11-12","title":"0.2.0 - 2020-11-12","text":"<ul> <li>Auto vacuum tables after install/upgrade of the database</li> <li>Add an option to auto open the dock from the locator</li> <li>Add a new field data_last_update</li> <li>Add an algorithm to set database connections for normal users</li> <li>Review default HTML templates</li> <li>Fix filter for QGS files in Processing</li> </ul>"},{"location":"CHANGELOG/#010-2020-11-03","title":"0.1.0 - 2020-11-03","text":"<ul> <li>Automatically compute values from the table itself : feature count, CRS etc</li> <li>Improve QGIS form</li> <li>Improve the dock to display HTML metadata</li> <li>Use HTML templates stored in the database</li> <li>Display the layer geometry in the locator</li> <li>Add a flag to disable Processing algorithm if needed for non admin user</li> </ul>"},{"location":"CHANGELOG/#003-2020-10-20","title":"0.0.3 - 2020-10-20","text":"<ul> <li>Add a dock displaying basic metadata information</li> <li>Fix file filter about QGS file selector</li> <li>Improve error reporting from the locator</li> </ul>"},{"location":"CHANGELOG/#002-2020-10-15","title":"0.0.2 - 2020-10-15","text":"<ul> <li>Add French language</li> </ul>"},{"location":"CHANGELOG/#001-2020-10-14","title":"0.0.1 - 2020-10-14","text":"<ul> <li>Provide a basic locator for adding layers</li> <li>Install the database schema</li> <li>Provide a QGIS project to edit the metadata</li> </ul>"},{"location":"CONTRIBUTING/","title":"Contributing","text":"<p>This project is hosted on GitHub.</p> <p>Visit GitHub</p>"},{"location":"CONTRIBUTING/#translation","title":"Translation","text":"<p>The UI is available on Transifex, no development knowledge is required. You need to create an account, request the language if your language is not available by default (we will happily accept) and start to translate strings.</p> <p>To translate the metadata glossary, the SQL file needs to be edited.</p> <p>If you change an SQL file, you need to add a migration file, located in <code>pg_metadata/install/sql/upgrade/</code>. These files are run according to the current version of the database to be sure that an existing database can also be upgraded to a newer version of the plugin.</p> <p>SQL files located in <code>pg_metadata/install/sql/pgmetadata</code> are run only on a new database.</p> <p>Example of a migration file to update the glossary with German language :</p> <pre><code>CREATE TABLE pgmetadata.t_glossary (field text, code text, label_de text, description_de text);\n\nINSERT INTO pgmetadata.t_glossary (field, code, label_de, description_de)\nVALUES\n('dataset.publication_frequency', 'WEE', 'w\u00f6chentlich', 'Daten werden w\u00f6chentlich aktualisiert')\nON CONFLICT DO NOTHING;\n\nUPDATE pgmetadata.glossary AS g\nSET (label_de, description_de)\n= (t.label_de, t.description_de)\nFROM pgmetadata.t_glossary AS t\nWHERE g.field = t.field AND g.code = t.code;\n\nDROP TABLE pgmetadata.t_glossary;\n</code></pre> <p>You can submit a  PR on GitHub or feel free to contact us for any assistance. There are some languages available already.</p>"},{"location":"CONTRIBUTING/#code","title":"Code","text":"<p>SQL and Python are covered by unittests with Docker.</p> <pre><code>pip install -r requirements/dev.txt\n# Check errors\nflake8\n# Sort imports\nisort .\nmake tests\nmake test_migration\n</code></pre> <p>On a new database, if you want to install the database by using migrations :</p> <pre><code>import os\nos.environ['TEST_DATABASE_INSTALL_PGMETADATA'] = '0.0.1'  # Enable\ndel os.environ['TEST_DATABASE_INSTALL_PGMETADATA']  # Disable\n</code></pre>"},{"location":"CONTRIBUTING/#documentation","title":"Documentation","text":"<p>The documentation is using MkDocs with Material.</p> <pre><code>pip install -r requirements/doc.txt\nmkdocs serve\n</code></pre>"},{"location":"changelog/","title":"Changelog","text":""},{"location":"changelog/#changelog","title":"Changelog","text":""},{"location":"changelog/#unreleased","title":"Unreleased","text":""},{"location":"changelog/#131-2024-09-02","title":"1.3.1 - 2024-09-02","text":"<ul> <li>Fix Python error if no previous folder was found </li> <li>Raise to QGIS 3.22 minimum version</li> <li>Upgrade to PostgreSQL 13 for testing and SQL files</li> </ul>"},{"location":"changelog/#130-2024-02-05","title":"1.3.0 - 2024-02-05","text":"<ul> <li>Additional glossary terms for publication frequency and link types (contribution from @effjot Florian Jenn)</li> <li>Glossary terms for unknown license and confidentiality</li> <li>Add remaining INSPIRE contact roles and UK Open Government Licence</li> <li>Add \u201cnon-standard\u201d contact roles and publication frequencies</li> <li>Add remaining INSPIRE contact roles and UK Open Government Licence (contribution from @mixedbredie Ross McDonald)</li> <li>Fix icon for layers having M values (linear referencing) (contribution from @effjot Florian Jenn)</li> <li>Review German translations (contribution from @effjot Florian Jenn)</li> </ul>"},{"location":"changelog/#122-2023-05-15","title":"1.2.2 - 2023-05-15","text":"<ul> <li>Fix \"array exceeds maximum\" for layers with many features (contribution from @effjot Florian Jenn)</li> </ul>"},{"location":"changelog/#121-2022-09-07","title":"1.2.1 - 2022-09-07","text":"<ul> <li>Fix a warning about invalid database</li> <li>Add the phone field to \"Contacts\" in the administration project</li> </ul>"},{"location":"changelog/#120-2022-09-05","title":"1.2.0 - 2022-09-05","text":"<ul> <li>License - Release PgMetadata under the GNU General Public License v2.0.</li> <li>Raise the QGIS minimum version to 3.16</li> <li>Add raster support (contribution from @effjot Florian Jenn)</li> <li>Fix handling of backslashes in file:// links to Windows files (contribution from @effjot Florian Jenn)</li> <li>Add phone number field (contribution from @effjot Florian Jenn)</li> <li>Email links are now clickable</li> <li>Connection names are now separated by <code>!!::!!</code> so that semicolons (former separator) can be used in connection names</li> </ul>"},{"location":"changelog/#111-2022-02-14","title":"1.1.1 - 2022-02-14","text":"<ul> <li>Fix an error when PgMetadata database is not temporary reachable</li> <li>Check that PostgreSQL is minimum 9.6 when installing the schema</li> </ul>"},{"location":"changelog/#110-2021-09-29","title":"1.1.0 - 2021-09-29","text":"<ul> <li>Add support for PostgreSQL views (contribution from @tschuettenberg QGIS Germany)</li> <li>Add translations for the German language (contribution from @effjot)</li> <li>Add new contact role \"originator\" and \"processor\" (contribution from @effjot)</li> <li>Add new frequencies for data update \"biannually\", \"irregular\" and \"not planned\" (contribution from @effjot)</li> <li>Add new German licenses (contribution from @effjot)</li> <li>Add more fields when searching with the locator bar (contribution from @effjot)</li> <li>Fix encoding issues in some situations, always set UTF-8 when opening files</li> <li>Fix the administration project about constraint with date but without a default value</li> <li>Update also the field \"update_date\" when updating a dataset entry in the trigger</li> </ul>"},{"location":"changelog/#100-2021-05-27","title":"1.0.0 - 2021-05-27","text":"<ul> <li>Add links to the file browser after exporting to PDF, HTML or XML</li> <li>Fix an issue when loading a layer from the locator bar, the style wasn't loaded before</li> <li>Update documentation https://docs.3liz.org/qgis-pgmetadata-plugin/</li> <li>Release on https://plugins.qgis.org</li> </ul>"},{"location":"changelog/#050-2021-02-19","title":"0.5.0 - 2021-02-19","text":"<ul> <li>Review the full online documentation using a proper website</li> <li>Add a link to the plugin online help in the QGIS help menu</li> <li>Add a button to open the dock from the QGIS plugin menu</li> <li>Add a layer flattening the \"dataset\" table containing all links and contacts, easier to export all the catalog</li> <li>Improve the deployment of the plugin within an organization to hide and setup some tools in PgMetadata</li> </ul>"},{"location":"changelog/#040-2021-01-21","title":"0.4.0 - 2021-01-21","text":"<ul> <li>Improve documentation user guide and schemaspy</li> <li>Save a metadata sheet as DCAT XML</li> <li>Add localized glossary labels and description : it, fr, es, de</li> <li>Display the translated HTML in the dock when available</li> <li>Add data_last_update in the HTML template</li> <li>Add some layers in the QGIS administration project</li> </ul>"},{"location":"changelog/#030-2020-12-14","title":"0.3.0 - 2020-12-14","text":"<ul> <li>Update online documentation</li> <li>Add export as PDF/HTML button in the dock</li> </ul>"},{"location":"changelog/#022-2020-11-17","title":"0.2.2 - 2020-11-17","text":"<ul> <li>Fix locator SQL query</li> <li>Add themes</li> <li>Update of the QGIS project</li> </ul>"},{"location":"changelog/#021-2020-11-16","title":"0.2.1 - 2020-11-16","text":"<ul> <li>Improve HTML templates for making them compatible with Lizmap</li> <li>SQL - Fix calculate a spatial field with Z or M geometries</li> <li>SQL - Fix HTML generation for fields email and size</li> <li>Processing - Fix upgrade algorithm and add tests</li> <li>Fix bug with empty links when link has no mime or type - fixes #34</li> <li>SQL - Fix if the envelope is a point, or a line</li> <li>SQL - Add a view to query only valid dataset with the locator</li> <li>Fix running migrations in the Processing algorithm</li> </ul>"},{"location":"changelog/#020-2020-11-12","title":"0.2.0 - 2020-11-12","text":"<ul> <li>Auto vacuum tables after install/upgrade of the database</li> <li>Add an option to auto open the dock from the locator</li> <li>Add a new field data_last_update</li> <li>Add an algorithm to set database connections for normal users</li> <li>Review default HTML templates</li> <li>Fix filter for QGS files in Processing</li> </ul>"},{"location":"changelog/#010-2020-11-03","title":"0.1.0 - 2020-11-03","text":"<ul> <li>Automatically compute values from the table itself : feature count, CRS etc</li> <li>Improve QGIS form</li> <li>Improve the dock to display HTML metadata</li> <li>Use HTML templates stored in the database</li> <li>Display the layer geometry in the locator</li> <li>Add a flag to disable Processing algorithm if needed for non admin user</li> </ul>"},{"location":"changelog/#003-2020-10-20","title":"0.0.3 - 2020-10-20","text":"<ul> <li>Add a dock displaying basic metadata information</li> <li>Fix file filter about QGS file selector</li> <li>Improve error reporting from the locator</li> </ul>"},{"location":"changelog/#002-2020-10-15","title":"0.0.2 - 2020-10-15","text":"<ul> <li>Add French language</li> </ul>"},{"location":"changelog/#001-2020-10-14","title":"0.0.1 - 2020-10-14","text":"<ul> <li>Provide a basic locator for adding layers</li> <li>Install the database schema</li> <li>Provide a QGIS project to edit the metadata</li> </ul>"},{"location":"contributing/","title":"Contributing","text":""},{"location":"contributing/#contributing","title":"Contributing","text":"<p>This project is hosted on GitHub.</p> <p>Visit GitHub</p>"},{"location":"contributing/#translation","title":"Translation","text":"<p>The UI is available on Transifex, no development knowledge is required. You need to create an account, request the language if your language is not available by default (we will happily accept) and start to translate strings.</p> <p>To translate the metadata glossary, the SQL file needs to be edited.</p> <p>If you change an SQL file, you need to add a migration file, located in <code>pg_metadata/install/sql/upgrade/</code>. These files are run according to the current version of the database to be sure that an existing database can also be upgraded to a newer version of the plugin.</p> <p>SQL files located in <code>pg_metadata/install/sql/pgmetadata</code> are run only on a new database.</p> <p>Example of a migration file to update the glossary with German language :</p> <pre><code>CREATE TABLE pgmetadata.t_glossary (field text, code text, label_de text, description_de text);\n\nINSERT INTO pgmetadata.t_glossary (field, code, label_de, description_de)\nVALUES\n('dataset.publication_frequency', 'WEE', 'w\u00f6chentlich', 'Daten werden w\u00f6chentlich aktualisiert')\nON CONFLICT DO NOTHING;\n\nUPDATE pgmetadata.glossary AS g\nSET (label_de, description_de)\n= (t.label_de, t.description_de)\nFROM pgmetadata.t_glossary AS t\nWHERE g.field = t.field AND g.code = t.code;\n\nDROP TABLE pgmetadata.t_glossary;\n</code></pre> <p>You can submit a  PR on GitHub or feel free to contact us for any assistance. There are some languages available already.</p>"},{"location":"contributing/#code","title":"Code","text":"<p>SQL and Python are covered by unittests with Docker.</p> <pre><code>pip install -r requirements/dev.txt\n# Check errors\nflake8\n# Sort imports\nisort .\nmake tests\nmake test_migration\n</code></pre> <p>On a new database, if you want to install the database by using migrations :</p> <pre><code>import os\nos.environ['TEST_DATABASE_INSTALL_PGMETADATA'] = '0.0.1'  # Enable\ndel os.environ['TEST_DATABASE_INSTALL_PGMETADATA']  # Disable\n</code></pre>"},{"location":"contributing/#documentation","title":"Documentation","text":"<p>The documentation is using MkDocs with Material.</p> <pre><code>pip install -r requirements/doc.txt\nmkdocs serve\n</code></pre>"},{"location":"lizmap/","title":"Lizmap Web Client","text":"<p>The metadata can be displayed in the QGIS Lizmap Web Client using the PgMetadata module.</p> <p>The module is also providing a DCAT catalog, ready to be harvested \ud83d\ude80.</p> <p></p>"},{"location":"references/","title":"References","text":""},{"location":"references/#exemple","title":"Exemple","text":""},{"location":"references/#gard-province-in-france","title":"Gard province in France","text":"<p>The French Gard province is using this project on their Lizmap Web Client instance to display the metadata, and the catalog is harvested by the French Open Data portal data.gouv.fr.</p> <p>As a consequence, the province has its own page on the national portal showing the same metadata.</p> <p>Lydia Courret, administratrice SIG au d\u00e9partement du Gard, in French \ud83c\uddeb\ud83c\uddf7</p> <p>Le D\u00e9partement du Gard disposait en interne d\u2019un recensement des m\u00e9tadonn\u00e9es de l\u2019ensemble des couches vecteurs de la base PostgreSQL sur Excel. En externe, une trentaine de couches \u00e9taient catalogu\u00e9es sur la plateforme r\u00e9gionale d\u2019OpenIG. Dans le portail de cartes Lizmap du d\u00e9partement (https://sig.gard.fr/), certaines informations li\u00e9es aux m\u00e9tadonn\u00e9es \u00e9taient saisies et publi\u00e9es dans la description de chacune des couches. Il n\u2019y avait pas de liens entre ces diff\u00e9rentes briques. L\u2019enjeu \u00e9tait de proposer un catalogue interop\u00e9rable entre les diff\u00e9rentes briques de la plateforme au d\u00e9partement du Gard :  Postgres / QGIS / Lizmap en \u00e9vitant les doubles saisies de m\u00e9tadonn\u00e9es : un catalogue accessible depuis QGIS pour les agents d\u00e9partementaux, accessible depuis les cartes dynamiques Lizmap et moissonnable. </p> <p>3Liz par l\u2019interm\u00e9diaire du d\u00e9veloppement d\u2019une extension, PgMetadata, a r\u00e9pondu aux attentes du  D\u00e9partement du Gard.</p> <ul> <li> <p>Pour l\u2019administrateur SIG, cette extension permet de stocker toutes les m\u00e9tadonn\u00e9es des couches vecteurs   dans 4 tables postgres. Un simple projet d\u2019administration QGIS permet via des formulaires une saisie   facilit\u00e9e des m\u00e9tadonn\u00e9es, une partie des champs \u00e9tant aliment\u00e9e automatiquement.</p> </li> <li> <p>Les utilisateurs de QGIS quant \u00e0 eux, trouvent et chargent une donn\u00e9e dans leurs projets en saisissant   un simple mot cl\u00e9 dans le gestionnaire de source de donn\u00e9es postgreSQL ou via le Locator de QGIS. Un   panneau de m\u00e9tadonn\u00e9es est visible pour chacune des couches int\u00e9gr\u00e9es au projet. Cette recherche et    cette consultation des m\u00e9tadonn\u00e9es s\u2019int\u00e8grent parfaitement au projet QGIS et permettent aux   utilisateurs de prendre connaissance des caract\u00e9ristiques de chaque couche charg\u00e9e dans le projet. </p> </li> </ul> <p>Ces m\u00eames fiches de m\u00e9tadonn\u00e9es sont consultables \u00e9galement sur le portail de cartes web du d\u00e9partement. Ainsi, les citoyens acc\u00e8dent aussi \u00e0 ces fiches.</p> <p>Enfin, l\u2019objectif est d\u2019int\u00e9grer ces m\u00e9tadonn\u00e9es pour les donn\u00e9es ouvertes sur le portail de la r\u00e9gion OPenIG via un export DCAT.</p> <p>Cette extension PgMetadata a l\u2019avantage d\u2019\u00eatre simple d\u2019utilisation que ce soit pour les administrateurs, les utilisateurs de QGIS. Elle permet d\u2019ouvrir les m\u00e9tadonn\u00e9es sur l\u2019ext\u00e9rieur via le portail de cartes dynamiques ou via des plateformes d\u00e9di\u00e9es \u00e0 l\u2019ouverture des geodatas et des m\u00e9tadonn\u00e9es attenantes. </p> <p>Cette extension PgMetadata est donc avant tout au service des administrateurs et des utilisateurs de QGIS et de par la publication des fiches de m\u00e9tadonn\u00e9es sur l\u2019ext\u00e9rieur au service des citoyens.</p> <p></p> <p>Thanks to the French Gard province for funding this project.</p>"},{"location":"references/#conference","title":"Conference","text":""},{"location":"references/#qgis-french-day-2020","title":"QGIS-French day 2020","text":"<p>A presentation in French at the QGIS-Day in December 2020 :</p>"},{"location":"references/#foss4g-2021-buenos-aires","title":"FOSS4G 2021 Buenos Aires","text":"<p>A presentation in English during the FOSS4G 2021 :</p>"},{"location":"roadmap/","title":"Roadmap","text":"<p>We have a few ideas how we can improve PgMetadata :</p> <ul> <li>Export to spreadsheet format</li> <li>Inspire</li> <li>Translation</li> <li>Support remote database</li> <li>More integration with the   QGIS native metadata editor</li> </ul> <p>Feel free to contact us by mail or discussion the GitHub issue tracker.</p>"},{"location":"processing/","title":"Processing","text":""},{"location":"processing/#administration","title":"Administration","text":""},{"location":"processing/#create-metadata-administration-project","title":"Create metadata administration project","text":"<p>This algorithm will create a new QGIS project file for PgMetadata administration purpose.</p> <p>The generated QGIS project must then be opened by the administrator to create the needed metadata by using QGIS editing capabilities.</p> <p>CONNECTION_NAME : The database where the schema 'pgmetadata' is installed.</p> <p>PROJECT_FILE : The destination file where to create the QGIS project.</p> <p></p>"},{"location":"processing/#parameters","title":"Parameters","text":"ID Description Type Info Required Advanced Option CONNECTION_NAME Connection to the PostgreSQL database String The database where the schema 'pgmetadata' is installed. \u2713 PROJECT_FILE QGIS project file to create FileDestination The destination file where to create the QGIS project. \u2713"},{"location":"processing/#outputs","title":"Outputs","text":"ID Description Type Info PROJECT_FILE QGIS project file to create File"},{"location":"processing/#set-connections-to-databases","title":"Set connections to databases","text":"<p>This algorithm will enable different databases where to look for metadata.</p> <p>DATABASES : PgMetadata can be installed on different databases.</p> <p></p>"},{"location":"processing/#parameters_1","title":"Parameters","text":"ID Description Type Info Required Advanced Option DATABASES List of databases to look for metadata Enum PgMetadata can be installed on different databases. \u2713 Values:"},{"location":"processing/#outputs_1","title":"Outputs","text":"ID Description Type Info No output"},{"location":"processing/#database","title":"Database","text":""},{"location":"processing/#installation-of-the-database-structure","title":"Installation of the database structure","text":"<p>When you are running the plugin for the first time on a new database, you need to install the database schema.</p> <p>It will erase and/or create the schema 'pgmetadata'.</p> <p>CONNECTION_NAME : The database where the schema 'pgmetadata' will be installed.</p> <p>OVERRIDE : ** Be careful ** This will remove data in the schema !</p> <p></p>"},{"location":"processing/#parameters_2","title":"Parameters","text":"ID Description Type Info Required Advanced Option CONNECTION_NAME Connection to the PostgreSQL database String The database where the schema 'pgmetadata' will be installed. \u2713 OVERRIDE Erase the schema pgmetadata ? Boolean ** Be careful ** This will remove data in the schema ! \u2713"},{"location":"processing/#outputs_2","title":"Outputs","text":"ID Description Type Info DATABASE_VERSION Database version String"},{"location":"processing/#recompute-values-in-the-dataset-table","title":"Recompute values in the dataset table","text":"<p>Recalculate spatial related fields for all dataset item</p> <p>CONNECTION_NAME : The database where the schema 'pgmetadata' has been installed.</p> <p>RESET : ** Be careful ** This will recompute default values.</p> <p></p>"},{"location":"processing/#parameters_3","title":"Parameters","text":"ID Description Type Info Required Advanced Option CONNECTION_NAME Connection to the PostgreSQL database String The database where the schema 'pgmetadata' has been installed. \u2713 RESET Recompute values in the dataset table Boolean ** Be careful ** This will recompute default values. \u2713"},{"location":"processing/#outputs_3","title":"Outputs","text":"ID Description Type Info No output"},{"location":"processing/#reset-html-templates-in-the-database","title":"Reset HTML templates in the database","text":"<p>Reset HTML templates in the database</p> <p>CONNECTION_NAME : The database where the schema 'pgmetadata' has been installed.</p> <p>RESET : ** Be careful ** This will reset existing HTML templates !</p> <p></p>"},{"location":"processing/#parameters_4","title":"Parameters","text":"ID Description Type Info Required Advanced Option CONNECTION_NAME Connection to the PostgreSQL database String The database where the schema 'pgmetadata' has been installed. \u2713 RESET Reset HTML templates Boolean ** Be careful ** This will reset existing HTML templates ! \u2713"},{"location":"processing/#outputs_4","title":"Outputs","text":"ID Description Type Info No output"},{"location":"processing/#upgrade-the-database-structure","title":"Upgrade the database structure","text":"<p>When the plugin is upgraded, a database upgrade may be available as well. The database migration must be applied as well on the existing database.</p> <p>CONNECTION_NAME : The database where the schema 'pgmetadata' is installed.</p> <p>RUN_MIGRATIONS : For security reason, we ask that you explicitly use this checkbox.</p> <p></p>"},{"location":"processing/#parameters_5","title":"Parameters","text":"ID Description Type Info Required Advanced Option CONNECTION_NAME Connection to the PostgreSQL database String The database where the schema 'pgmetadata' is installed. \u2713 RUN_MIGRATIONS Use this checkbox to upgrade. Boolean For security reason, we ask that you explicitly use this checkbox. \u2713"},{"location":"processing/#outputs_5","title":"Outputs","text":"ID Description Type Info DATABASE_VERSION Database version String"},{"location":"user-guide/","title":"User guide","text":"<p>This user guide has been split into 4 sections mainly :</p> <ul> <li>a quick start guide showing how to install and use PgMetadata</li> <li>for end users, such as GIS technician who are not editing metadata or managing the PostGIS database</li> <li>for GIS administrator who are maintaining the PostGIS database, creating new metadata</li> <li>for system administrator when PgMetadata is deployed within an organization</li> <li>for advanced users for using data from the database with SQL queries</li> </ul>"},{"location":"user-guide/advanced/","title":"Advanced","text":"<p>As described in the end user guide, it's possible to export a single dataset or the full catalog as XML DCAT or as HTML. All this logic is generated in the database itself.</p> <p>The QGIS PgMetadata dock or Lizmap Web Client are taking advantage of this to publish the DCAT catalog on the web, by calling the SQL query to generate the XML DCAT catalog on the database.</p> <p>If you are not using Lizmap to publish your QGIS projects on the web, you can easily write your own wrapper (using Flask or any other WEB framework) to call these SQL queries.</p> <p>To generate the HTML for a given dataset :</p> <pre><code>SELECT pgmetadata.get_dataset_item_html_content('{schema}', '{table}', '{locale}');\n</code></pre> <p>To generate the DCAT XML for a one or many datasets :</p> <pre><code>SELECT\n    dataset\nFROM\n    pgmetadata.get_datasets_as_dcat_xml('{locale}','[{uuid}]');\n</code></pre> <p>If you are building your own wrapper around PgMetadata to reuse DCAT catalog, feel free to contact us or to submit a PR with a reference to your source code \u2665</p>"},{"location":"user-guide/end-user/","title":"End user","text":""},{"location":"user-guide/end-user/#locator","title":"Locator","text":"<p>Type Ctrl+K in QGIS to open the locator widget. You can start type <code>meta</code> then you should see layers in the list.</p> <p></p>"},{"location":"user-guide/end-user/#datasource-manager","title":"Datasource manager","text":"<p>This works without the plugin installed on the computer. It's native in QGIS.</p> <p></p>"},{"location":"user-guide/end-user/#panel","title":"Panel","text":"<p>The PgMetadata panel can be opened. If set, the layer metadata will be displayed according to the layer  selected in the legend.</p> <p></p>"},{"location":"user-guide/end-user/#export-a-single-metadata","title":"Export a single metadata","text":"<p>To export a metadata sheet as PDF, HTML or DCAT, you need to select a layer in your layer tree saved in the  metadata table <code>dataset</code>. Then in the dock you have a button to open the <code>export menu</code> and choose the output format.</p> <p></p> <p>If no layer with metadata are selected, you can't click on the button of the <code>export menu</code>.</p> <p></p>"},{"location":"user-guide/end-user/#export-the-catalog","title":"Export the catalog","text":"<p>From the dock, it's possible to add a layer in the legend showing the full catalog. The main dataset table is flatten to show contacts and links as well.</p> <p>The user can export this non-spatial layer as CSV by right clicking on the layer then Export.</p>"},{"location":"user-guide/gis-admin/","title":"GIS administrator","text":""},{"location":"user-guide/gis-admin/#installation","title":"Installation","text":""},{"location":"user-guide/gis-admin/#database","title":"Database","text":"<p>The plugin is using a schema in PostgreSQL.</p> <ul> <li>If you just installed the plugin in a new organization, you must use the   install database structure</li> <li>If the <code>pgmetadata</code> schema is already existing in your database, you may need to upgrade it after a   plugin upgrade using the upgrade database structure</li> </ul> <p>Warning</p> <p>With the administration project, it's only possible to add metadata for tables which are stored in the same PostgreSQL database. For now, it's not possible to reference tables which are stored in another database. The use of the  foreign schema might work but has not been tested yet.</p>"},{"location":"user-guide/gis-admin/#administration-project","title":"Administration project","text":"<p>The GIS administrator can generate a QGIS project using create metadata project. You need to open the generated project and use the normal QGIS editing tools.</p> <p>In the group called <code>Information Warnings</code> :</p> <ul> <li><code>Orphan metadata</code> displays table not existing in the database itself, but the metadata exists in the   <code>dataset</code> table.</li> <li><code>Orphan tables</code> is the reverse. It displays tables existing in the database but in the <code>dataset</code> table.</li> </ul>"},{"location":"user-guide/gis-admin/#editing-metadata","title":"Editing metadata","text":"<p>Before creating metadata for your layer/table, you need to implement some table. To edit this table you need to open the attribute table, switch on Edition mode and add a new row.</p> <p>Switching to edit mode:</p> <p></p> <p>Adding a new row:</p> <p></p> <p>Switching to the form view: You can access the form view in the bottom right corner of the attribute table.</p> <p></p> <ol> <li> <p>On the <code>Theme</code> table you can add many theme corresponding to different theme of your layers.     You need to enter a code e.g. \"A01\", and a label corresponding at the name e.g. \"Naturals area\".     Example adding theme:</p> <p></p> </li> <li> <p>On the <code>Contact</code> table you can add contacts that can later be associated with your metadata layer.     Example new contact:</p> <p></p> </li> <li> <p>The <code>Dataset</code> table is the metadata table. You can add many rows and one added line corresponds to a     metadata of a layer.     You need to fill a row with these minimum information : </p> <ul> <li>Table name,</li> <li>Schema name,</li> <li>Title,</li> <li>Abstract,</li> <li>Etc</li> </ul> <p>Example to add a new metadata for a layer:   On the second picture you can see the theme.</p> <p></p> </li> <li> <p>Now you can add a contact to a dataset row with the <code>Dataset</code> table. You can click on a tab called <code>contact</code>.     You need to allow edit mode in this tab because you implement another table.     Example:</p> <p></p> </li> <li> <p>You can add some<code>Link</code> to a dataset row with the <code>Dataset</code> table. It's same that to add a contact,    you have a link tab.     Don't forget to allow edit mode.     Example:</p> <p></p> </li> </ol> <p>When you stop editing a table, don't forget to save your change with clicking on the save icon et leave the edit mode. To save:</p> <p></p> <p>To leave the edit mode you need to click on the same button that to enter the edit mode.</p>"},{"location":"user-guide/gis-admin/#html-template","title":"HTML Template","text":""},{"location":"user-guide/gis-admin/#principle","title":"Principle","text":"<p>The metadata panel is showing all information using HTML templates. These are stored in the database itself. The layer named html_template is displayed in the legend in the administration project.</p> <p>There are 3 rows in the table :</p> <ul> <li>One template for the metadata sheet without contacts and links.</li> <li>One template for a single link.</li> <li>One template for a single contact.</li> </ul> <p>These last two templates will be generated many times for each link and incorporated in the first template.</p>"},{"location":"user-guide/gis-admin/#edit-or-translate-these-templates","title":"Edit or translate these templates","text":"<p>You can customize the HTML template by opening the attribute table of that layer and switching editing mode. Either you might want to translate some hardcoded strings in the HTML or you want to change the HTML layout.</p> <ul> <li>Use <code>[% \"name_of_field\" %]</code> to display a specific field, eg <code>abstract</code>.</li> <li>use <code>[% meta_contacts %]</code> to display all contacts related. It's using the template called <code>contact</code>.</li> <li>use <code>[% meta_links %]</code> to display all links related. It's using the template called <code>link</code>.</li> </ul> <p>Tip</p> <p>If you want to reset to default the HTML templates, you can use the Processing algorithm in the toolbox.</p> <p>Tip</p> <p>Check the video tutorial at 13 minutes 05 secondes covering the HTML templates.</p>"},{"location":"user-guide/sys-admin/","title":"Sys admin","text":""},{"location":"user-guide/sys-admin/#deploying-within-an-organization","title":"Deploying within an organization","text":"<p>When QGIS is deployed within an organization, the system administrator can hide administration Processing tools from normal users and also set the default path where PgMetadata is installed.</p> <p>Example of a <code>QGIS3.ini</code> file which activates the plugin automatically and set 3 connections where PgMetadata is installed :</p> <pre><code>[pgmetadata]\nauto_open_dock=true\nend_user_only=true\nconnection_names=Connection 1!!::!!Connection 2!!::!!Connection 3\n\n[Plugins]\npg_metadata=true\n</code></pre> <p>The string <code>!!::!!</code> is used to split different connection names.</p> <ul> <li><code>end_user_only</code> is designed to hide Processing algorithms which are designed for PgMetadata administrator.</li> <li><code>connection_names</code> is a list of connections separated by <code>;</code> so PgMetadata knows where to look for metadata.</li> </ul> <p>The last section <code>Plugins</code> showed above is to automatically load the plugin if the plugin folder is installed by a deployment tool.</p>"},{"location":"user-guide/tutorials/","title":"Tutorials","text":""},{"location":"user-guide/tutorials/#introduction","title":"Introduction","text":"<p>In these videos, we will cover how to set up and use PgMetadata, for both the  GIS Administrator (installation of the database schema, create metadata\u2026) and the final  user GIS technician (searching for a specific layer, exporting as HTML\u2026).</p> <p>We will use the geopackage file provided. In QGIS,  <code>Project</code> \u27a1 <code>Open From\u2026</code> \u27a1 <code>Geopackage</code>, there is a single project called <code>project</code>. This dataset is a subset of the Corsica island in France from OpenStreetMap.</p> Info <p>OpenStreetMap\u00ae is open data, licensed under the Open Data Commons Open Database License (ODbL) by the OpenStreetMap Foundation (OSMF). We must use the credit \"\u00a9 OpenStreetMap contributors\". https://www.openstreetmap.org/copyright/en</p>"},{"location":"user-guide/tutorials/#installation","title":"Installation","text":"<p>In this video, we are explaining :</p> <ul> <li>the online documentation</li> <li>the database schema</li> <li>how to install and or upgrade the schema</li> <li>how to generate the QGIS project for metadata editing</li> </ul>"},{"location":"user-guide/tutorials/#edition","title":"Edition","text":"<p>In this video, we are explaining how to edit metadata with the administration project :</p> <ul> <li>Contacts</li> <li>Links</li> <li>Metadata</li> <li>HTML templates</li> <li>Themes</li> <li>PostgreSQL views for orphan tables or orphan metadata sheets</li> </ul>"},{"location":"user-guide/tutorials/#search-in-the-catalog-from-qgis","title":"Search in the catalog from QGIS","text":"<p>In this video, we are explaining how to re-use the metadata in QGIS Desktop :</p> <ul> <li>Without the PgMetadata plugin with the QGIS data source manager</li> <li>With the plugin using the locator bar</li> <li>Exporting a single layer metadata as PDF, HTML or PDF</li> <li>Exporting the whole catalog</li> </ul>"},{"location":"user-guide/tutorials/#publish-metadata-on-the-web","title":"Publish metadata on the web","text":"<p>In this video, we are explaining how to re-use the metadata outside of QGIS Desktop :</p> <ul> <li>With PgMetadata module for Lizmap</li> <li>Write your own wrapper to extract DCAT information</li> </ul>"}]}